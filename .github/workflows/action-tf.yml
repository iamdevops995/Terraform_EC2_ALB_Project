name: Infrastructure provisioning using teraform

on:
  workflow_dispatch:
  workflow_call:
jobs:
  terraform-setup:
    name: Terraform setup
    runs-on: ubuntu-24.04
    steps:
      - name: checkout reposistory
        uses: actions/checkout@v5
      - name: Terraform setup
        uses: hashicorp/setup-terraform@v3
      - name: check terraform cli version
        run: terraform --version
      - name: aws-configure
        uses: ./.github/actions/aws-oidc/
        with:
          role-to-assume: arn:aws:iam::537726824414:role/OpenIDGithubRole
          aws-region: us-east-1
      - name: Terraform format
        id: fmt
        run: terraform fmt -check
        continue-on-error: true
      - name: Terraform Init
        id: init
        run: terraform init -input=false
      - name: Terraform validate
        id: validate
        run: terraform validate -no-color
      - name: Terraform Plan
        id: plan
        run: terraform plan -no-color -input=false
        continue-on-error: true
